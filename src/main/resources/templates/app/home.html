<!DOCTYPE html>
<body xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/app}">
<div layout:fragment="content" class="main-content">
    <h1 class="text-primary">
        Welcome
        <span th:text="${account?.nickname}" class="text-black"></span>
    </h1>
    <div th:if="${account != null && !account.emailConfirmed}"
         class="alert alert-warning mb-5" role="alert">
        아직 이메일 인증을 완료하지 않은 계정입니다.<br />
        가입하신 메일계정으로 인증을 완료 후 로그인 부탁드립니다.
    </div>

    <div class="container text-center">
        <th:block sec:authorize="isAnonymous()" >
            <div class="row align-items-center mb-5">
                <div class="col text-end">
                    <a th:href="@{/auth/sign-up}" class="btn btn-outline-primary">회원가입</a>
                </div>
                <div class="col text-start">
                    <a th:href="@{/auth/login}" class="btn btn-outline-success">로그인</a>
                </div>
            </div>
        </th:block>
        <th:block sec:authorize="isAuthenticated()" >
            <div class="row align-items-center mb-5">
                <div class="col text-end">
                    <a th:href="@{/posts}" class="btn btn-outline-primary">게시물 작성</a>
                </div>
                <div class="col text-start">
                    <form action="#" th:action="@{/logout}" method="POST" class="inline">
                        <button type="submit" class="btn btn-outline-secondary">로그아웃</button>
                    </form>
                </div>
            </div>
            <div>
                <table class="table table-hover mb-5 bg-white shadow">
                    <thead>
                    <tr>
                        <th scope="col">No</th>
                        <th scope="col">제목</th>
                        <th scope="col">작성자</th>
                        <th scope="col">작성일</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="post, iter : ${posts}" class="clickable" th:attr="data-post-id=${post.id}">
                        <th scope="row" th:text="${iter.size - iter.index}">1</th>
                        <td th:text="${post.title}">title</td>
                        <td th:text="${post.account.nickname}">nickname</td>
                        <td th:text="${post.createdAt}">createdAt</td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </th:block>
    </div>
</div>
<script type="application/javascript" layout:fragment="script">

    document.addEventListener("DOMContentLoaded", () => {
        const rows = document.querySelectorAll('.clickable')
        for (const row of rows) {
            row.addEventListener('click', onClick)
        }
    });

    function onClick() {
        const postId = this.dataset.postId
        location.href = '/posts/' + postId;
    }

</script>
</body>